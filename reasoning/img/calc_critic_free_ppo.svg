<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 950">
  <!-- Background with subtle gradient -->
  <defs>
    <linearGradient id="bg-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#f9f9f9" />
      <stop offset="100%" stop-color="#f0f0f0" />
    </linearGradient>
    
    <!-- Arrow Marker Definition -->
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333333"/>
    </marker>
    
    <!-- Glow effect for highlight -->
    <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
      <feGaussianBlur stdDeviation="4" result="blur"/>
      <feComposite in="SourceGraphic" in2="blur" operator="over"/>
    </filter>
  </defs>
  
  <!-- Background with rounded corners -->
  <rect width="800" height="950" fill="url(#bg-gradient)" rx="15" ry="15"/>
  
  <!-- Title with subtle shadow -->
  <text x="400" y="50" font-family="Arial, sans-serif" font-size="26" font-weight="bold" text-anchor="middle" fill="#222222" filter="url(#glow)">Calculate Critic-free Grouped PPO Loss</text>
  
  <!-- Old Model Box - Increased width and vertical spacing -->
  <rect x="42" y="102" width="340" height="80" rx="8" ry="8" fill="#f5f5f5" stroke="#a0a0a0" stroke-width="1"/>
  <rect x="38" y="98" width="340" height="80" rx="8" ry="8" fill="#efefef" stroke="#a0a0a0" stroke-width="1"/>
  <rect x="34" y="94" width="340" height="80" rx="8" ry="8" fill="#e8e8e8" stroke="#a0a0a0" stroke-width="1"/>
  <rect x="30" y="90" width="340" height="80" rx="8" ry="8" fill="#f7f7f7" stroke="#909090" stroke-width="2"/>
  <text x="200" y="115" font-family="Arial, sans-serif" font-size="15" font-weight="bold" text-anchor="middle" fill="#333333">[1×8] Old Model Selected Softmax Logits</text>
  
  <!-- Old Model Selected Logits Array - Increased horizontal spacing -->
  <rect x="70" y="140" width="30" height="20" rx="2" ry="2" fill="#f5f5f5" stroke="#666666" stroke-width="1"/>
  <rect x="115" y="140" width="30" height="20" rx="2" ry="2" fill="#f5f5f5" stroke="#666666" stroke-width="1"/>
  <rect x="160" y="140" width="30" height="20" rx="2" ry="2" fill="#f5f5f5" stroke="#666666" stroke-width="1"/>
  <rect x="205" y="140" width="30" height="20" rx="2" ry="2" fill="#f5f5f5" stroke="#666666" stroke-width="1"/>
  <rect x="250" y="140" width="30" height="20" rx="2" ry="2" fill="#f5f5f5" stroke="#666666" stroke-width="1"/>
  <text x="85" y="155" font-family="Courier New, monospace" font-size="12" text-anchor="middle" fill="#333333">0.91</text>
  <text x="130" y="155" font-family="Courier New, monospace" font-size="12" text-anchor="middle" fill="#333333">0.88</text>
  <text x="175" y="155" font-family="Courier New, monospace" font-size="12" text-anchor="middle" fill="#333333">0.88</text>
  <text x="220" y="155" font-family="Courier New, monospace" font-size="12" text-anchor="middle" fill="#333333">0.92</text>
  <text x="265" y="155" font-family="Courier New, monospace" font-size="12" text-anchor="middle" fill="#333333">0.93</text>
  <text x="290" y="155" font-family="Courier New, monospace" font-size="14" text-anchor="middle" fill="#333333">...</text>
  
  <!-- Train Model Box - Increased width and vertical spacing -->
  <rect x="442" y="102" width="340" height="80" rx="8" ry="8" fill="#eef2ff" stroke="#6e93e0" stroke-width="1"/>
  <rect x="438" y="98" width="340" height="80" rx="8" ry="8" fill="#e6edff" stroke="#6e93e0" stroke-width="1"/>
  <rect x="434" y="94" width="340" height="80" rx="8" ry="8" fill="#dee6ff" stroke="#6e93e0" stroke-width="1"/>
  <rect x="430" y="90" width="340" height="80" rx="8" ry="8" fill="#f0f5ff" stroke="#3976d8" stroke-width="2"/>
  <text x="600" y="115" font-family="Arial, sans-serif" font-size="15" font-weight="bold" text-anchor="middle" fill="#333333">[1×8] Train Model Selected Softmax Logits</text>
  
  <!-- Train Model Selected Logits Array - Increased horizontal spacing -->
  <rect x="470" y="140" width="30" height="20" rx="2" ry="2" fill="#f0f5ff" stroke="#3976d8" stroke-width="1"/>
  <rect x="515" y="140" width="30" height="20" rx="2" ry="2" fill="#f0f5ff" stroke="#3976d8" stroke-width="1"/>
  <rect x="560" y="140" width="30" height="20" rx="2" ry="2" fill="#f0f5ff" stroke="#3976d8" stroke-width="1"/>
  <rect x="605" y="140" width="30" height="20" rx="2" ry="2" fill="#f0f5ff" stroke="#3976d8" stroke-width="1"/>
  <rect x="650" y="140" width="30" height="20" rx="2" ry="2" fill="#f0f5ff" stroke="#3976d8" stroke-width="1"/>
  <text x="485" y="155" font-family="Courier New, monospace" font-size="12" text-anchor="middle" fill="#333333">0.92</text>
  <text x="530" y="155" font-family="Courier New, monospace" font-size="12" text-anchor="middle" fill="#333333">0.86</text>
  <text x="575" y="155" font-family="Courier New, monospace" font-size="12" text-anchor="middle" fill="#333333">0.87</text>
  <text x="620" y="155" font-family="Courier New, monospace" font-size="12" text-anchor="middle" fill="#333333">0.90</text>
  <text x="665" y="155" font-family="Courier New, monospace" font-size="12" text-anchor="middle" fill="#333333">0.92</text>
  <text x="690" y="155" font-family="Courier New, monospace" font-size="14" text-anchor="middle" fill="#333333">...</text>
  
  <!-- Arrows pointing down to calculation box - Adjusted for wider box and new position -->
  <path d="M 200 190 L 200 210" stroke="#333333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 600 190 L 600 210" stroke="#333333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Calculation Box - Wider and moved up -->
  <rect x="170" y="210" width="460" height="60" rx="8" ry="8" fill="#f4f4f4" stroke="#999999" stroke-width="1.5"/>
  <text x="400" y="245" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="#333333">Calculate:   Train Softmax Logits  ÷  Old Softmax Logits</text>
  
  <!-- Probability Ratio Box - Adjusted position -->
  <rect x="262" y="312" width="300" height="80" rx="8" ry="8" fill="#f0fff5" stroke="#4CAF50" stroke-width="1"/>
  <rect x="258" y="308" width="300" height="80" rx="8" ry="8" fill="#e6ffe9" stroke="#4CAF50" stroke-width="1"/>
  <rect x="254" y="304" width="300" height="80" rx="8" ry="8" fill="#d9ffd9" stroke="#4CAF50" stroke-width="1"/>
  <rect x="250" y="300" width="300" height="80" rx="8" ry="8" fill="#f0fff5" stroke="#4CAF50" stroke-width="2"/>
  <text x="400" y="325" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="#333333">Probability Ratio</text>
  
  <!-- Probability Ratio Array - Increased horizontal spacing -->
  <rect x="270" y="350" width="30" height="20" rx="2" ry="2" fill="#efffef" stroke="#4CAF50" stroke-width="1"/>
  <rect x="315" y="350" width="30" height="20" rx="2" ry="2" fill="#efffef" stroke="#4CAF50" stroke-width="1"/>
  <rect x="360" y="350" width="30" height="20" rx="2" ry="2" fill="#efffef" stroke="#4CAF50" stroke-width="1"/>
  <rect x="405" y="350" width="30" height="20" rx="2" ry="2" fill="#efffef" stroke="#4CAF50" stroke-width="1"/>
  <rect x="450" y="350" width="30" height="20" rx="2" ry="2" fill="#efffef" stroke="#4CAF50" stroke-width="1"/>
  <text x="285" y="365" font-family="Courier New, monospace" font-size="12" text-anchor="middle" fill="#333333">1.01</text>
  <text x="330" y="365" font-family="Courier New, monospace" font-size="12" text-anchor="middle" fill="#333333">0.98</text>
  <text x="375" y="365" font-family="Courier New, monospace" font-size="12" text-anchor="middle" fill="#333333">0.99</text>
  <text x="420" y="365" font-family="Courier New, monospace" font-size="12" text-anchor="middle" fill="#333333">0.98</text>
  <text x="465" y="365" font-family="Courier New, monospace" font-size="12" text-anchor="middle" fill="#333333">0.99</text>
  <text x="490" y="365" font-family="Courier New, monospace" font-size="14" text-anchor="middle" fill="#333333">...</text>
  
  <!-- Arrow from calculation to ratio - Adjusted for new position -->
  <path d="M 400 270 L 400 300" stroke="#333333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Advantages Box - Adjusted position -->
  <rect x="62" y="412" width="300" height="80" rx="8" ry="8" fill="#fff4e6" stroke="#FF9800" stroke-width="1"/>
  <rect x="58" y="408" width="300" height="80" rx="8" ry="8" fill="#ffefe1" stroke="#FF9800" stroke-width="1"/>
  <rect x="54" y="404" width="300" height="80" rx="8" ry="8" fill="#ffe9d9" stroke="#FF9800" stroke-width="1"/>
  <rect x="50" y="400" width="300" height="80" rx="8" ry="8" fill="#fff8f0" stroke="#FF9800" stroke-width="2"/>
  <text x="200" y="425" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="#333333">Advantage</text>
  
  <!-- Advantages value WITHOUT a box - modified as requested -->
  <text x="200" y="465" font-family="Courier New, monospace" font-size="18" font-weight="bold" text-anchor="middle" fill="#FF9800">0.1</text>
  
  <!-- Calculation Box 2 - Adjusted position -->
  <rect x="220" y="510" width="360" height="50" rx="8" ry="8" fill="#f2f2f2" stroke="#999999" stroke-width="1.5"/>
  <text x="400" y="540" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="#333333">Calculate: Probability Ratio × Advantages</text>
  
  <!-- Arrows to calculation - Adjusted positions -->
  <path d="M 200 480 L 220 525" stroke="#333333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 400 380 L 400 510" stroke="#333333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Objectives Box - Centered horizontally -->
  <rect x="262" y="602" width="300" height="80" rx="8" ry="8" fill="#f3e5f5" stroke="#9C27B0" stroke-width="1"/>
  <rect x="258" y="598" width="300" height="80" rx="8" ry="8" fill="#efe0f3" stroke="#9C27B0" stroke-width="1"/>
  <rect x="254" y="594" width="300" height="80" rx="8" ry="8" fill="#e9d8ee" stroke="#9C27B0" stroke-width="1"/>
  <rect x="250" y="590" width="300" height="80" rx="8" ry="8" fill="#f7ebf9" stroke="#9C27B0" stroke-width="2"/>
  <text x="400" y="615" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="#333333">Objectives</text>
  
  <!-- Objectives Array - Centered horizontally -->
  <rect x="270" y="640" width="30" height="20" rx="2" ry="2" fill="#f7ebf9" stroke="#9C27B0" stroke-width="1"/>
  <rect x="315" y="640" width="30" height="20" rx="2" ry="2" fill="#f7ebf9" stroke="#9C27B0" stroke-width="1"/>
  <rect x="360" y="640" width="30" height="20" rx="2" ry="2" fill="#f7ebf9" stroke="#9C27B0" stroke-width="1"/>
  <rect x="405" y="640" width="30" height="20" rx="2" ry="2" fill="#f7ebf9" stroke="#9C27B0" stroke-width="1"/>
  <rect x="450" y="640" width="30" height="20" rx="2" ry="2" fill="#f7ebf9" stroke="#9C27B0" stroke-width="1"/>
  <text x="285" y="655" font-family="Courier New, monospace" font-size="12" text-anchor="middle" fill="#333333">0.25</text>
  <text x="330" y="655" font-family="Courier New, monospace" font-size="12" text-anchor="middle" fill="#333333">0.41</text>
  <text x="375" y="655" font-family="Courier New, monospace" font-size="12" text-anchor="middle" fill="#333333">0.18</text>
  <text x="420" y="655" font-family="Courier New, monospace" font-size="12" text-anchor="middle" fill="#333333">0.32</text>
  <text x="465" y="655" font-family="Courier New, monospace" font-size="12" text-anchor="middle" fill="#333333">0.45</text>
  <text x="490" y="655" font-family="Courier New, monospace" font-size="14" text-anchor="middle" fill="#333333">...</text>
  
  <!-- Arrow from calculation to objectives - Updated for centered objectives -->
  <path d="M 400 560 L 400 590" stroke="#333333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Clipping Calculation Box -->
  <rect x="170" y="720" width="460" height="60" rx="8" ry="8" fill="#f0f0f0" stroke="#999999" stroke-width="1.5"/>
  <text x="400" y="755" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="#333333">Calculate: -clip(Probability Ratio) × Advantages</text>
  
  <!-- GRPO Loss Box -->
  <rect x="262" y="830" width="300" height="60" rx="8" ry="8" fill="#e3f2fd" stroke="#2196F3" stroke-width="1"/>
  <rect x="258" y="826" width="300" height="60" rx="8" ry="8" fill="#bbdefb" stroke="#2196F3" stroke-width="1"/>
  <rect x="254" y="822" width="300" height="60" rx="8" ry="8" fill="#90caf9" stroke="#2196F3" stroke-width="1"/>
  <rect x="250" y="818" width="300" height="60" rx="8" ry="8" fill="#e1f5fe" stroke="#2196F3" stroke-width="3"/>
  <text x="400" y="855" font-family="Arial, sans-serif" font-size="20" font-weight="bold" text-anchor="middle" fill="#0D47A1">Critic-free Grouped PPO Loss</text>
  
  <!-- Arrows for final calculations -->
  <path d="M 400 670 L 400 720" stroke="#333333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 400 780 L 400 818" stroke="#333333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
</svg>